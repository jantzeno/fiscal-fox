<app-header></app-header>
<div class="mx-auto">
  <h2>Budget List</h2>
  <div>
    <a [routerLink]="['/budgets/new']"> New Budget </a>
  </div>
  <table
    class="table table-striped"
    *ngIf="budgets$ | async as budgets; else loadingBudgets"
  >
    <thead>
      <tr>
        <th scope="col">Budget</th>
        <th scope="col"><!-- Edit --></th>
        <th scope="col">Amount</th>
        <th scope="col"># Expenses</th>
        <th scope="col">Expenses Total</th>
        <th scope="col">Remaining</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let budget of budgets; let id = index">
        <th>
          <a [routerLink]="['/budgets/details', budget.id]">
            {{ budget.name }}
          </a>
        </th>
        <th>
          <a [routerLink]="['/budgets/edit', budget.id]"> Edit </a>
        </th>
        <th>{{ budget.amount | currency }}</th>
        <th>{{ getExpenseCount(budget, expenses$ | async) }}</th>
        <th>
          {{ getExpenseTotalForBudget(budget, expenses$ | async) | currency }}
        </th>
        <th
          [ngClass]="{
            deficit: isDeficit(getRemainingBudget(budget, expenses$ | async))
          }"
        >
          {{ getRemainingBudget(budget, expenses$ | async) | currency }}
        </th>
      </tr>
    </tbody>
  </table>

  <ng-template #loadingBudgets>
    <div>Loading Budgets...</div>
  </ng-template>
</div>
